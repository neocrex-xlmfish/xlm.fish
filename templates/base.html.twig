<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{% block title %}XLMFISH{% endblock %}</title>
    {% include '_meta.html.twig' %}
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#05668D',
              secondary: '#427AA1',
              lightbg: '#EBF2FA',
              green1: '#679436',
              green2: '#A5BE00'
            }
          }
        }
      };
    </script>

    {# favicons (replace files in public/ as needed) #}
    <link rel="icon" href="{{ asset('favicon.ico') }}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset('img/apple-touch-icon.png') }}" />
    <meta name="theme-color" content="#05668D" />

    {# --- Theme variables + small overrides for Tailwind classes --- #}
    <style>
      /* Page-level theme variables */
      :root {
        --bg: #ffffff;
        --fg: #0f1724;
        --muted: #6b7280;
        --accent: #05668D;
        --header-bg: rgba(255,255,255,0.9);
        --header-border: rgba(0,0,0,0.06);

        /* Market / card defaults */
        --card-bg: #ffffff;
        --card-fg: #0f1724;
        --card-muted: #6b7280;
        --card-border: rgba(0,0,0,0.06);
        --card-header-bg: #f8fafc; /* light table header background */
        --card-row-hover: #f8fafc;  /* light hover row */
      }

      /* Dark theme overrides */
      .dark {
        --bg: #071026;
        --fg: #e6eef8;
        --muted: #9aa6b2;
        --accent: #60a5fa;
        --header-bg: rgba(7,16,38,0.6);
        --header-border: rgba(255,255,255,0.06);

        --card-bg: #071726;       /* slightly lighter than page bg for separation */
        --card-fg: #e6eef8;
        --card-muted: #9aa6b2;
        --card-border: rgba(255,255,255,0.06);
        --card-header-bg: rgba(255,255,255,0.03); /* subtle header in dark mode */
        --card-row-hover: rgba(255,255,255,0.02);
      }

      /* Apply page-level background and text color */
      html, body {
        background: var(--bg) !important;
        color: var(--fg) !important;
      }

      /* Theme helper classes */
      .theme-section { background: transparent; }
      .theme-card {
        background: var(--card-bg) !important;
        color: var(--card-fg) !important;
        border-color: var(--card-border) !important;
      }
      .theme-card thead { background: var(--card-header-bg) !important; }
      .theme-card .muted { color: var(--card-muted) !important; }
      .theme-card .heading-accent { color: var(--accent) !important; }

      /* Make .theme-link a convenience class for elements that should follow theme fg */
      .theme-link { color: var(--fg) !important; }
      .theme-link:hover { color: var(--accent) !important; }

      /* table row hover, border and text overrides inside theme-card so JS-inserted classes remain readable */
      .theme-card .border-gray-200 { border-color: var(--card-border) !important; }
      .theme-card .text-gray-900 { color: var(--card-fg) !important; }
      .theme-card .text-gray-600 { color: var(--card-muted) !important; }
      .theme-card .hover\:bg-gray-50:hover { background: var(--card-row-hover) !important; }

      /* Header/footer icon visibility (Feather icons use stroke='currentColor' and inherit color) */
      .theme-header [data-feather],
      .theme-header svg,
      .theme-header i {
        color: var(--fg) !important;
        stroke: currentColor !important;
        fill: none !important;
      }

      /* Slightly accent icons on hover to show interactivity */
      .theme-header a:hover [data-feather],
      .theme-header a:hover svg,
      .theme-header a:hover i {
        color: var(--accent) !important;
      }

      /* Footer icons also follow fg in both modes */
      .theme-footer [data-feather],
      .theme-footer svg,
      .theme-footer i {
        color: var(--fg) !important;
        stroke: currentColor !important;
        fill: none !important;
      }

      /* Ensure any inline icon classes that set stroke or fill are overridden in themed areas */
      .theme-header [data-feather] * { stroke: currentColor !important; }
      .theme-footer [data-feather] * { stroke: currentColor !important; }

      /* Small theme toggle styling */
      #theme-toggle {
        display: inline-flex;
        align-items: center;
        gap: .4rem;
        padding: .35rem .5rem;
        border-radius: .5rem;
        border: 1px solid transparent;
        background: transparent;
      }
      .theme-toggle-active {
        background: var(--accent);
        color: #fff;
      }
    </style>

    {% block head_extra %}{% endblock %}
  </head>

  <body class="bg-lightbg text-gray-900 font-sans">
    {% include 'partials/_nav.html.twig' %}

    <main id="main" class="min-h-screen">
      {% block body %}{% endblock %}
    </main>

    {% include 'partials/_footer.html.twig' %}

    {# third-party libs first (Chart.js for charts) #}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    {# feather-icons + other libs #}
    <script src="https://unpkg.com/feather-icons"></script>

    {# site JS (from public/js) ‚Äî use asset() so Symfony knows the path #}
    <script src="{{ asset('js/cache.js') }}"></script>
    <script src="{{ asset('js/market-overview.js') }}"></script>
    <script src="{{ asset('js/lp-topn-chart.js') }}"></script>
    <script src="{{ asset('js/lp-viewer.js') }}"></script>

    <script>feather.replace();</script>

    {# --- Theme toggle behavior: respects system pref, persists to localStorage --- #}
    <script>
      (function () {
        const root = document.documentElement;
        const toggle = document.getElementById('theme-toggle');
        const icon = document.getElementById('theme-toggle-icon');
        // label may be a span.theme-muted inside the button or an element with id theme-toggle-label
        const label = toggle ? (toggle.querySelector('.theme-muted') || document.getElementById('theme-toggle-label')) : null;

        function setUIFor(theme) {
          if (theme === 'dark') {
            root.classList.add('dark');
            if (toggle) {
              toggle.setAttribute('aria-pressed', 'true');
              toggle.classList.add('theme-toggle-active');
            }
            if (icon) icon.textContent = '‚òÄÔ∏è';
            if (label) label.textContent = 'Light';
          } else {
            root.classList.remove('dark');
            if (toggle) {
              toggle.setAttribute('aria-pressed', 'false');
              toggle.classList.remove('theme-toggle-active');
            }
            if (icon) icon.textContent = 'üåô';
            if (label) label.textContent = 'Dark';
          }
        }

        function save(theme) {
          try { localStorage.setItem('theme', theme); } catch (e) { /* ignore */ }
        }

        // initialize: stored preference wins, otherwise system preference
        let stored = null;
        try { stored = localStorage.getItem('theme'); } catch (e) { /* ignore */ }

        if (stored) {
          setUIFor(stored);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          setUIFor('dark');
        } else {
          setUIFor('light');
        }

        // attach click handler
        if (toggle) {
          toggle.addEventListener('click', function () {
            const next = root.classList.contains('dark') ? 'light' : 'dark';
            setUIFor(next);
            save(next);
          });
        }

        // sync with system theme changes only if user hasn't set a preference
        if (window.matchMedia) {
          const mq = window.matchMedia('(prefers-color-scheme: dark)');
          mq.addEventListener && mq.addEventListener('change', function (e) {
            try {
              if (!localStorage.getItem('theme')) {
                setUIFor(e.matches ? 'dark' : 'light');
              }
            } catch (err) { /* ignore */ }
          });
        }
      })();
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>