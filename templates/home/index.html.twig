{% extends 'base.html.twig' %}

{% block title %}XLMFISH on Stellar – Overview & Live Metrics{% endblock %}

{% block head_extra %}
  <meta property="og:title" content="XLMFISH on Stellar – Overview & Live Metrics" />
  <meta property="og:description" content="Live price, 24h volume, and market cap for XLMFISH on Stellar." />
{% endblock %}

{% block body %}
  <!-- Hero -->
  <section class="bg-primary text-white py-24 text-center px-6">
    <img src="{{ asset('xlmfish_sm.png') }}" alt="XLMFISH Logo" class="w-32 h-32 mx-auto mb-4">
    <h1 class="text-4xl font-bold mb-2">XLMFISH</h1>
    <p class="text-lg">Overview and live metrics on the Stellar network</p>

    {# Issuer: show compressed on small screens, full address on md+; include explicit copy button with feedback #}
    <p class="text-sm opacity-90 mt-2">
      Asset: XLMFISH | Issuer:
      <span class="inline-flex items-center gap-2">
        {# Full address visible on md+ screens; breaks if needed #}
        <span id="issuer-full" class="hidden md:inline break-all select-all">GAX3YQC26LTS6NLW2QGRQC4MK24XKL5JLZ7KFHNERWPC3HKCT2ABTEMT</span>

        {# Compressed address visible on small screens only; clickable for copy #}
        <span id="issuer-short" class="inline md:hidden cursor-pointer underline" title="Copy issuer address">GAX3Y..ABTEMT</span>

        {# Copy button (visible on all sizes). Icon from feather – will be replaced by feather.replace() #}
        <button id="issuer-copy"
                class="inline-flex items-center gap-2 ml-2 px-2 py-1 rounded border border-white/20 bg-white/10 hover:bg-white/20 text-white text-sm"
                aria-label="Copy issuer address"
                title="Copy issuer address">
          <i data-feather="copy" class="w-4 h-4"></i>
          <span class="sr-only">Copy issuer address</span>
        </button>

        {# Accessible and visible feedback; shown briefly after copy #}
        <span id="issuer-copied" role="status" aria-live="polite" class="ml-2 text-xs opacity-90 hidden">Copied!</span>
      </span>
    </p>
  </section>

  <!-- Market Overview -->
  <section id="market-overview" class="py-12 px-6 theme-section">
    <div class="max-w-5xl mx-auto">
      <h2 class="text-2xl font-semibold mb-6 text-secondary text-center">Market Overview</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="flex flex-col items-center p-8 border-l-4 border-primary rounded-lg shadow theme-card">
          <i data-feather="dollar-sign" class="w-12 h-12 mb-4 text-primary"></i>
          <h3 class="text-lg font-semibold mb-1 heading-accent">Price (USD)</h3>
          <p class="text-2xl font-bold" id="price-usd">—</p>
          <p class="text-xs muted mt-2">per token</p>
        </div>

        <div class="flex flex-col items-center p-8 border-l-4 border-green2 rounded-lg shadow theme-card">
          <i data-feather="trending-up" class="w-12 h-12 mb-4 text-green2"></i>
          <h3 class="text-lg font-semibold mb-1 heading-accent">24h Volume (USD)</h3>
          <p class="text-2xl font-bold" id="volume-24h-usd">—</p>
          <p class="text-xs muted mt-2">across pools</p>
        </div>

        <div class="flex flex-col items-center p-8 border-l-4 border-primary rounded-lg shadow theme-card">
          <i data-feather="pie-chart" class="w-12 h-12 mb-4 text-primary"></i>
          <h3 class="text-lg font-semibold mb-1 heading-accent">Market Cap (USD)</h3>
          <p class="text-2xl font-bold" id="market-cap-usd">—</p>
          <p class="text-xs muted mt-2">approximate (amount × price)</p>
        </div>
      </div>

      <p class="text-center text-xs muted mt-4" id="market-updated">Fetching live data...</p>

      {# Short, user-facing disclaimer under market overview #}
      <p class="text-center text-xs muted mt-3">
        XLMFISH is an experimental token and project on the Stellar blockchain. This site is provided for informational purposes only and does not constitute financial, investment, or legal advice.
      </p>
    </div>
  </section>

  {# Project status partial (non-technical, audience-friendly) #}
  {% include 'home/_status.html.twig' %}

  {# CTA partial (Get XLMFISH + disclaimer) #}
  {% include 'home/_cta.html.twig' %}
{% endblock %}

{% block scripts %}
  {# feather-icons replacement and site scripts; Chart.js is included in base if needed #}
  <script>feather.replace();</script>

  <script>
    // Copy issuer address behavior with visible feedback.
    document.addEventListener('DOMContentLoaded', () => {
      const FULL_ADDR = 'GAX3YQC26LTS6NLW2QGRQC4MK24XKL5JLZ7KFHNERWPC3HKCT2ABTEMT';
      const copyBtn = document.getElementById('issuer-copy');
      const shortEl = document.getElementById('issuer-short');
      const feedback = document.getElementById('issuer-copied');

      async function doCopy() {
        if (!navigator.clipboard) {
          // Fallback: select & execCommand
          const ta = document.createElement('textarea');
          ta.value = FULL_ADDR;
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); } catch (e) { console.error(e); }
          document.body.removeChild(ta);
          showFeedback();
          return;
        }
        try {
          await navigator.clipboard.writeText(FULL_ADDR);
          showFeedback();
        } catch (e) {
          console.error('Copy failed', e);
          // still show feedback with error text briefly
          showFeedback('Copy failed');
        }
      }

      function showFeedback(msg = 'Copied!') {
        if (!feedback) return;
        feedback.textContent = msg;
        feedback.classList.remove('hidden');
        setTimeout(() => {
          feedback.classList.add('hidden');
          feedback.textContent = 'Copied!';
        }, 1600);
      }

      if (copyBtn) copyBtn.addEventListener('click', doCopy);
      if (shortEl) shortEl.addEventListener('click', doCopy);
    });
  </script>
{% endblock %}